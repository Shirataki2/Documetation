



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://docs.kcs18.net/unity/2017/04-chapter3/">
      
      
        <meta name="author" content="Tomoya Ishii">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.6">
    
    
      
        <title>Stage2 - KCS Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/notosansjp.css">
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:600,800">
    
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    
      <link rel="stylesheet" href="../../../css/custom.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="purple">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#stage2" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://docs.kcs18.net" title="KCS Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                KCS Documentation
              </span>
              <span class="md-header-nav__topic">
                Stage2
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../python/00-about/" title="Python" class="md-tabs__link">
          Python
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../機械学習/00-ml-index/" title="機械学習" class="md-tabs__link">
          機械学習
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../blender/" title="Blender" class="md-tabs__link">
          Blender
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../" title="Unity" class="md-tabs__link md-tabs__link--active">
          Unity
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../etc/" title="Admin" class="md-tabs__link">
          Admin
        </a>
      
    </li>
  

  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://docs.kcs18.net" title="KCS Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    KCS Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/00-about/" title="はじめに" class="md-nav__link">
      はじめに
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/01-install/" title="環境構築" class="md-nav__link">
      環境構築
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      機械学習
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        機械学習
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../機械学習/00-ml-index/" title="はじめに" class="md-nav__link">
      はじめに
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Blender
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Blender
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../blender/" title="ようこそ" class="md-nav__link">
      ようこそ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      2017年度講習会
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        2017年度講習会
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../blender/01-install/" title="blenderのインストール" class="md-nav__link">
      blenderのインストール
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../blender/02-makescene/" title="簡単なシーンの製作" class="md-nav__link">
      簡単なシーンの製作
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../blender/03-omake/" title="さらなる高みを目指して" class="md-nav__link">
      さらなる高みを目指して
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Unity
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Unity
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="ようこそ" class="md-nav__link">
      ようこそ
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2" checked>
    
    <label class="md-nav__link" for="nav-5-2">
      2017年度講習会
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        2017年度講習会
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../01-introduction/" title="はじめに" class="md-nav__link">
      はじめに
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../02-chapter1/" title="Unityでゲーム制作をする準備" class="md-nav__link">
      Unityでゲーム制作をする準備
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../03-chapter2/" title="Stage1" class="md-nav__link">
      Stage1
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Stage2
      </label>
    
    <a href="./" title="Stage2" class="md-nav__link md-nav__link--active">
      Stage2
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="新しいシーンを作ろう" class="md-nav__link">
    新しいシーンを作ろう
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefab" title="prefab化しよう" class="md-nav__link">
    prefab化しよう
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="ゲームオブジェクトを複製しよう" class="md-nav__link">
    ゲームオブジェクトを複製しよう
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="ジャンプを実装する" class="md-nav__link">
    ジャンプを実装する
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="ボタンを押したかどうか判定する" class="md-nav__link">
    ボタンを押したかどうか判定する
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collider" title="Colliderに接触しているか判定する" class="md-nav__link">
    Colliderに接触しているか判定する
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="仕様の確認" class="md-nav__link">
    仕様の確認
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" title="カメラを追従させよう" class="md-nav__link">
    カメラを追従させよう
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" title="階層構造" class="md-nav__link">
    階層構造
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="スクリプトで追従" class="md-nav__link">
    スクリプトで追従
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-cameraprefab" title="Main Cameraをprefab化しよう" class="md-nav__link">
    Main Cameraをprefab化しよう
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stage2_1" title="Stage2の状態を確認しよう" class="md-nav__link">
    Stage2の状態を確認しよう
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Admin
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Admin
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-1" type="checkbox" id="nav-6-1">
    
    <label class="md-nav__link" for="nav-6-1">
      管理者ページ
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-1">
        管理者ページ
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../etc/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      変分ベイズ学習
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        変分ベイズ学習
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../etc/bayes/01/" title="１" class="md-nav__link">
      １
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3" type="checkbox" id="nav-6-3">
    
    <label class="md-nav__link" for="nav-6-3">
      ウェブデータの機械学習
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-3">
        ウェブデータの機械学習
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../etc/webml/01/" title="１" class="md-nav__link">
      １
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-4" type="checkbox" id="nav-6-4">
    
    <label class="md-nav__link" for="nav-6-4">
      入門 パターン認識と機械学習
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-4">
        入門 パターン認識と機械学習
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../etc/prml/01/" title="１" class="md-nav__link">
      １
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="新しいシーンを作ろう" class="md-nav__link">
    新しいシーンを作ろう
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefab" title="prefab化しよう" class="md-nav__link">
    prefab化しよう
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="ゲームオブジェクトを複製しよう" class="md-nav__link">
    ゲームオブジェクトを複製しよう
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="ジャンプを実装する" class="md-nav__link">
    ジャンプを実装する
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="ボタンを押したかどうか判定する" class="md-nav__link">
    ボタンを押したかどうか判定する
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collider" title="Colliderに接触しているか判定する" class="md-nav__link">
    Colliderに接触しているか判定する
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="仕様の確認" class="md-nav__link">
    仕様の確認
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" title="カメラを追従させよう" class="md-nav__link">
    カメラを追従させよう
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" title="階層構造" class="md-nav__link">
    階層構造
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="スクリプトで追従" class="md-nav__link">
    スクリプトで追従
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-cameraprefab" title="Main Cameraをprefab化しよう" class="md-nav__link">
    Main Cameraをprefab化しよう
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stage2_1" title="Stage2の状態を確認しよう" class="md-nav__link">
    Stage2の状態を確認しよう
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="stage2">Stage2<a class="headerlink" href="#stage2" title="Permanent link">#</a></h1>
<p><span id="est"  class="170"></span></p>
<p><br></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>このテキストは2017年4月に書かれたテキストをWeb用に変換したものです</p>
</div>
<p>今回は新しいシーンを作って前回学んだRigidbodyやColliderを応用していきます。
この章では以下の内容を学習していきます。</p>
<ul>
<li>Prefab化</li>
<li>スクリプト上でColliderの衝突判定を取得する方法</li>
<li>Transformをスクリプトで変更する方法</li>
</ul>
<h2 id="_1">新しいシーンを作ろう<a class="headerlink" href="#_1" title="Permanent link">#</a></h2>
<p>それでは、まず新しいシーンを作りましょう。
下図のように、<strong>「File」-&gt;「New Scene」</strong>を選択してください。</p>
<p><img alt="" src="../images/03/MakeNewScene.png" /></p>
<p>何も置かれていない初期状態のシーンが表示されていたら大丈夫です。</p>
<h2 id="prefab">prefab化しよう<a class="headerlink" href="#prefab" title="Permanent link">#</a></h2>
<p>さて、ここから新しいステージを作っていくわけですが、前章のような設定をいちいち行うのは大変です。
Playerはステージに関係なく使い続けたいゲームオブジェクトです。
Unityではこういった何度も使うゲームオブジェクトを再利用できるようにする仕組みがあります。
それがprefabです。</p>
<p>まずは現在のシーンを保存しましょう。
<strong>「Ctrl+S」-&gt;「Scenes」</strong>を選択します。
名前は<strong>「Stage2」</strong>としましょう。
以下の図のようになっていたら大丈夫です。</p>
<p><img alt="" src="../images/03/SaveScene.png" /></p>
<p>つづいて、<strong>「プロジェクトビューでScenes」-&gt;「Stage1」</strong>を選択してください。
前章で作成したシーンが表示されます。
それでは、prefab化していきます。
<strong>「プロジェクトビューのAssetsフォルダ上で右クリック」-&gt;「Create」-&gt;「Folder」</strong>を選択し、フォルダーを作ります。
名前を<strong>「Prefabs」</strong>とします。
次に、下図のように<strong>Prefabsフォルダーを開いた状態で、ヒエラルキービューからプロジェクトビューへとPlayerをドラッグアンドドロップ</strong>してください。</p>
<p><img alt="" src="../images/03/Prefab.png" /></p>
<p>すると、ヒエラルキービュー上の「Player」の文字が青く変わり、プロジェクトビュー上にPlayerが出現します。</p>
<p><img alt="" src="../images/03/ResultOfPrefab.png" /></p>
<p>Playerのprefab化が完了したら、NormalRoadもprefab化しておきましょう。</p>
<p>それではシーンを保存してStage2を開きましょう。
下図のように<strong>プロジェクトビューでPrefasフォルダーからヒエラルキービューへとPlayerをドラッグアンドドロップ</strong>してください。</p>
<p><img alt="" src="../images/03/DDPlayer.png" /></p>
<p>シーンにPlayerが配置されたと思います。
さらに、Stage1で行った設定をそのまま引き継いでいます。
同様にしてNormalRoadもシーンに配置しましょう。
これで、Stage1と全く同じシーンができました。</p>
<h2 id="_2">ゲームオブジェクトを複製しよう<a class="headerlink" href="#_2" title="Permanent link">#</a></h2>
<p><strong>ヒエラルキービューでNormalRoadを選択した状態にしてください。</strong>
ヒエラルキービュー上の<strong>NormalRoad</strong>が青くなっている状態になれば大丈夫です。
つづいて<span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-d">D</kbd></span>を押してください。
するとヒエラルキービューに「NormalRoad (1)」というゲームオブジェクトが生成されると思います。
その後NormalRoad (1)のTransformを以下のように編集してください。</p>
<table>
<thead>
<tr>
<th align="center">変更箇所</th>
<th align="center">変更内容</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Position</td>
<td align="center">(0, 1, 10)</td>
</tr>
</tbody>
</table>
<h2 id="_3">ジャンプを実装する<a class="headerlink" href="#_3" title="Permanent link">#</a></h2>
<p>さて、前節で作成したステージの端まで進むには段差を飛び越える必要がありますね。
この節では、スペースボタンが押されたらジャンプをするスクリプトを書いていきましょう。</p>
<p>まずは、前回学んだことを生かしてPlayerController.csを以下のように編集してみましょう。</p>
<!-- hl_lines="1 3" linenums="2" -->

<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>  <span class="c1">//…省略</span>
  <span class="kt">float</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">y</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span><span class="c1">//←追加</span>
  <span class="kt">float</span> <span class="n">z</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>

  <span class="c1">//…省略</span>

  <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="n">x</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">GetAxis</span><span class="p">(</span><span class="s">&quot;Horizontal&quot;</span><span class="p">);</span>
      <span class="n">y</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">GetAxis</span><span class="p">(</span><span class="s">&quot;Jump&quot;</span><span class="p">);</span><span class="c1">//←追加</span>
      <span class="n">z</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">GetAxis</span><span class="p">(</span><span class="s">&quot;Vertical&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">void</span> <span class="nf">FixedUpdate</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="n">Vector3</span> <span class="n">direction</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span><span class="c1">//←編集</span>
      <span class="n">playerRigidbody</span><span class="p">.</span><span class="n">AddForce</span><span class="p">(</span><span class="n">direction</span><span class="p">.</span><span class="n">normalized</span> <span class="p">*</span> <span class="n">speed</span><span class="p">);</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>
3行目に上方向の入力結果を代入する変数を宣言しました。
11行目に<code class="codehilite">Input.GetAxis(&quot;Jump&quot;)</code>とありますが、"Jump"は<span class="keys"><kbd class="key-space">Space</kbd></span>に対応したものです。
<span class="keys"><kbd class="key-space">Space</kbd></span>の押し具合によって0~1の値をとります。
これを6行目の<code class="codehilite">direction</code>に加えてやることで、y軸方向に力を与えジャンプさせようとしているのです。
それでは<span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-s">S</kbd></span>で保存し、ゲームを再生してみましょう。</p>
<p><span class="keys"><kbd class="key-space">Space</kbd></span>を押し続けると少しずつPlayerが上昇していくことがわかります。</p>
<p><img alt="" src="../images/03/FlyingPlayer.png" /></p>
<p>しかし、これでは「跳ぶ」というより「飛ぶ」といった感じですね。
原因を考えていきましょう。
まず、ゆっくりと飛んだ理由は力不足によるものです。
Playerには重力が働いているため、y軸方向に移動するためにはx、z軸方向に比べ大きな力が必要です。
また、<span class="keys"><kbd class="key-space">Space</kbd></span>を押し続けて上昇したのは、<code class="codehilite">FixedUpdate</code>メソッドの特徴です。
現実では、ジャンプをするとき地面を蹴る瞬間にしか力はかかりません。
しかしこのメソッドは一定間隔で呼ばれてしまうため、<span class="keys"><kbd class="key-space">Space</kbd></span>を押している間はy軸方向に力が加わり続けてしまうのです。</p>
<p>この節ではこの解決方法を学んでいきます。</p>
<h3 id="_4">ボタンを押したかどうか判定する<a class="headerlink" href="#_4" title="Permanent link">#</a></h3>
<p>まずは、ボタンを押した瞬間にだけ跳ぶようにしましょう。
実は<code class="codehilite">Input</code>クラスにはキーを押した瞬間にのみ、処理を行うメソッドがあります。
それは<code class="codehilite">GetButtonDown</code>メソッドです。
これは特定のボタンを押した瞬間に<code class="codehilite">true</code>を返し、それ以外のときは<code class="codehilite">false</code>を返す<code class="codehilite">bool</code>型のメソッドです。
GetAxisのように押具合を値として返してくれるわけではないので、同じような使い方ができないことに注意してください。
では、<code class="codehilite">PlayerController.cs</code>の<code class="codehilite">public class PlayerController : MonoBehaviour { }</code>内を以下のように編集してください。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">Rigidbody</span> <span class="n">playerRigidbody</span><span class="p">;</span>
<span class="na">[SerializeField]</span> <span class="kt">int</span> <span class="n">speed</span><span class="p">;</span>
<span class="na">[SerializeField]</span> <span class="kt">int</span> <span class="n">power</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span><span class="c1">//←追加</span>

<span class="c1">//…省略</span>

<span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">x</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">GetAxis</span><span class="p">(</span><span class="s">&quot;Horizontal&quot;</span><span class="p">);</span>
    <span class="n">z</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">GetAxis</span><span class="p">(</span><span class="s">&quot;Vertical&quot;</span><span class="p">);</span><span class="c1">//←編集</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">GetButtonDown</span><span class="p">(</span><span class="s">&quot;Jump&quot;</span><span class="p">)</span> <span class="p">==</span> <span class="k">true</span><span class="p">)</span><span class="c1">//←追加</span>
    <span class="p">{</span>
        <span class="n">y</span> <span class="p">=</span> <span class="n">power</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">void</span> <span class="nf">FixedUpdate</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Vector3</span> <span class="n">direction</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span><span class="c1">//←編集</span>
    <span class="n">playerRigidbody</span><span class="p">.</span><span class="n">AddForce</span><span class="p">(</span><span class="n">direction</span><span class="p">.</span><span class="n">normalized</span> <span class="p">*</span> <span class="n">speed</span><span class="p">);</span>
    <span class="n">playerRigidbody</span><span class="p">.</span><span class="n">AddForce</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">ForceMode</span><span class="p">.</span><span class="n">Impulse</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>では順番に見ていきましょう。</p>
<p><strong> <i class="fa fa-circle"></i> 3行目 </strong></p>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="na">  [SerializeField]</span> <span class="kt">int</span> <span class="n">power</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
</pre></div>
</td></tr></table>
ジャンプをする力の大きさを定義しています。
このコードのように初期化をすることでインスペクタービュー上で初めから値が代入された状態を作ることができます。
後ほど説明する<code class="codehilite">ForceMode.Impulse</code>を考慮して、<code class="codehilite">speed</code>より値を小さくしています。</p>
<p><strong> <i class="fa fa-circle"></i> 9-10行目 </strong></p>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">x</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">GetAxis</span><span class="p">(</span><span class="s">&quot;Horizontal&quot;</span><span class="p">);</span>
    <span class="n">z</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">GetAxis</span><span class="p">(</span><span class="s">&quot;Vertical&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>
先ほど編集した部分は使わないので上記のようにしておきましょう。</p>
<p><strong> <i class="fa fa-circle"></i> 11-18行目 </strong></p>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>  <span class="k">if</span> <span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">GetButtonDown</span><span class="p">(</span><span class="s">&quot;Jump&quot;</span><span class="p">)</span> <span class="p">==</span> <span class="k">true</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">y</span> <span class="p">=</span> <span class="n">power</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
      <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>
11行目では<code class="codehilite">if</code>文を使って、<code class="codehilite">Input.GetButtonDown(&quot;Jump&quot;)</code>が<code class="codehilite">true</code>になったとき、すなわち<span class="keys"><kbd class="key-space">Space</kbd></span>を押したときのみ{ }内のプログラムを実行します。
else文も利用して押したときには<code class="codehilite">power</code>を、押されていないときには<code class="codehilite">0</code>をそれぞれ<code class="codehilite">y</code>に代入します。</p>
<p><strong> <i class="fa fa-circle"></i> 23行目 </strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="n">Vector3</span> <span class="n">direction</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>10行目と同様に先ほど編集した部分は使わないので上記のようにしておきましょう。</p>
<p><strong> <i class="fa fa-circle"></i> 25行目 </strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>25</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>  <span class="n">playerRigidbody</span><span class="p">.</span><span class="n">AddForce</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">ForceMode</span><span class="p">.</span><span class="n">Impulse</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>実はこのように<code class="codehilite">AddForce</code>は<code class="codehilite">AddForce(x, y, z)</code>のようにして力を与えることもできます。
ところが、コードには四つ目の値がありますね。
この<code class="codehilite">ForceMode</code>は力の種類を表します。
<code class="codehilite">ForceMode.Impulse</code>は対象の<code class="codehilite">Rigidbody</code>の質量(Mass)使って瞬発的な力を加えます。
実はデフォルトでも<code class="codehilite">ForceMode</code>は設定されており、それは<code class="codehilite">ForceMode.Force</code>となります。
これは対象の質量を使用して、継続的に力を加え続けます。
同じ大きさの力でも<code class="codehilite">Impulse</code>は<code class="codehilite">Force</code>に比べ一瞬の力が大きくなります。</p>
<p>それでは<span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-s">S</kbd></span>でスクリプトを保存して、ゲームを再生しましょう。
確かに押し続けても上昇しなくなりましたが、何度も多段ジャンプできますね。</p>
<h3 id="collider">Colliderに接触しているか判定する<a class="headerlink" href="#collider" title="Permanent link">#</a></h3>
<p>さて、今度は床に乗っている間だけジャンプできるようにしましょう。
そのためにはPlayerがColliderに接触している間のみジャンプの入力を受け付けなければなりません。
まずは、PlayerController.csを以下のように編集してください。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>  <span class="c1">//…省略</span>
  <span class="kt">bool</span> <span class="n">isTouching</span><span class="p">;</span><span class="c1">//←追加</span>

  <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="n">x</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">GetAxis</span><span class="p">(</span><span class="s">&quot;Horizontal&quot;</span><span class="p">);</span>
      <span class="n">z</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">GetAxis</span><span class="p">(</span><span class="s">&quot;Vertical&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">GetButtonDown</span><span class="p">(</span><span class="s">&quot;Jump&quot;</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">isTouching</span><span class="p">)</span><span class="c1">//←編集</span>
      <span class="p">{</span>
          <span class="n">y</span> <span class="p">=</span> <span class="n">power</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
          <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
      <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">//…省略</span>

  <span class="k">void</span> <span class="nf">OnCollisionEnter</span><span class="p">()</span><span class="c1">//←追加</span>
  <span class="p">{</span>
      <span class="n">isTouching</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">void</span> <span class="nf">OnCollisionExit</span><span class="p">()</span><span class="c1">//←追加</span>
  <span class="p">{</span>
      <span class="n">isTouching</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>では説明していきます。</p>
<p><strong> <i class="fa fa-circle"></i> 2行目 </strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>  <span class="kt">bool</span> <span class="n">isTouching</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>床に接触しているか判定をこの変数に入れることにします。
もし、触れていたら<code class="codehilite">true</code>を、触れていなければ<code class="codehilite">false</code>を代入します。</p>
<p><strong> <i class="fa fa-circle"></i> 8行目 </strong></p>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span> <span class="k">if</span> <span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">GetButtonDown</span><span class="p">(</span><span class="s">&quot;Jump&quot;</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">isTouching</span><span class="p">)</span>
</pre></div>
</td></tr></table>
まず、今までは<code class="codehilite">Input.GetButtonDown(&quot;Jump&quot;)==true</code>としていましたが、13行目のように書くこともできます。
理由は以下の通りです。
<code class="codehilite">Input.GetButtonDown(&quot;Jump&quot;)</code>は<span class="keys"><kbd class="key-space">Space</kbd></span>が押されたときに<code class="codehilite">true</code>が返されます。
そしてif文の条件式は()内が<code class="codehilite">true</code>になればいいので、<span class="keys"><kbd class="key-space">Space</kbd></span>が押されている時13行目は<code class="codehilite">if(true)</code>となり、条件式を通過するのです。
また、ジャンプの条件式に、床にふれていることを追加します。
つまり、<code class="codehilite">isTouching</code>が<code class="codehilite">true</code>になっていることを条件に追加します。</p>
<p><strong> <i class="fa fa-circle"></i> 20-23行目 </strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">void</span> <span class="nf">OnCollisionEnter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">isTouching</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>このメソッドは何か<code class="codehilite">Collider</code>に接触した瞬間に一回だけ呼ばれます。
22行目のように判定である<code class="codehilite">isTouching</code>を<code class="codehilite">true</code>にすることで床に触れていることを表します。
<code class="codehilite">OnCollisionEnter</code>は以下のように記述して使用します。
<div class="codehilite"><pre><span></span><span class="k">void</span> <span class="nf">OnCollisionEnter</span><span class="p">(</span><span class="n">Collision</span> <span class="n">collision</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//ここに処理したいコードを記述する</span>
<span class="p">}</span>
</pre></div>
このメソッドにある<code class="codehilite">collision</code>にはぶつかったオブジェクトが代入され、メソッド内で利用することができます。
今回のコードのように利用しないこともできます。</p>
<p><strong> <i class="fa fa-circle"></i> 25-28行目 </strong></p>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>25
26
27
28</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>  <span class="k">void</span> <span class="nf">OnCollisionExit</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="n">isTouching</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>
このメソッドは<code class="codehilite">Collider</code>との接触が離れた瞬間に呼ばれます。
27行目のように判定である<code class="codehilite">isTouching</code>を<code class="codehilite">false</code>にすることで床から離れたことを表します。
<code class="codehilite">OnCollisionExit</code>は以下のように記述して使用します。</p>
<p><div class="codehilite"><pre><span></span><span class="k">void</span> <span class="nf">OnCollisionExit</span><span class="p">(</span><span class="n">Collision</span> <span class="n">collision</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//ここに処理したいコードを記述する</span>
<span class="p">}</span>
</pre></div>
このメソッドにある<code class="codehilite">collision</code>には離れたオブジェクトが代入され、メソッド内で利用することができます。
今回のコードのように利用しないこともできます。
これでジャンプの実装は完了です。
<span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-s">S</kbd></span>でスクリプトを保存したら、ゲームを再生させましょう。</p>
<h3 id="_5">仕様の確認<a class="headerlink" href="#_5" title="Permanent link">#</a></h3>
<p>さて、このジャンプの実装ではある面白い仕様を持ちます。
<strong>「ヒエラルキービューでCreate」-&gt;「3D Object」-&gt;「Cube」</strong>を選択したください。
設定は以下の通りです。</p>
<table>
<thead>
<tr>
<th align="center">変更箇所</th>
<th align="center">変更内容</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">オブジェクト名</td>
<td align="center">KickWall</td>
</tr>
<tr>
<td align="center">Position</td>
<td align="center">(0, 5.5, 15.5)</td>
</tr>
<tr>
<td align="center">Scale</td>
<td align="center">(3, 10, 1)</td>
</tr>
</tbody>
</table>
<p>設定が完了したらゲームを再生しましょう。
そして、先ほど作成した<code class="codehilite">KickWall</code>に向かって、<span class="keys"><kbd class="key-space">Space</kbd></span>を何度も押してください。</p>
<p>下図のように、<code class="codehilite">Player</code>が<code class="codehilite">KickWall</code>を上っていることに気が付きます。</p>
<p><img alt="" src="../images/03/KickPlayer.png" /></p>
<p>これは、<code class="codehilite">OnCollisionStay</code>メソッドはステージの上面に限らずどの部分からでも、<code class="codehilite">Collider</code>に接触してさえいれば呼ばれるためです。</p>
<h2 id="_6">カメラを追従させよう<a class="headerlink" href="#_6" title="Permanent link">#</a></h2>
<p>そろそろ画面が見づらいですよね。
今度は画面を<code class="codehilite">Player</code>に追従させましょう。
現在ゲームビューに映し出されているプレイ画面はヒエラルキービューで「Main Camera」というカメラオブジェクトによって映し出されたものです。
この<code class="codehilite">Main Camera</code>の位置や角度を変更することで映し出される画面の位置や角度が変更します。</p>
<p>まずは、<code class="codehilite">Main Camera</code>を動かして<code class="codehilite">Player</code>がゲーム画面の中心に来るようにしましょう。
<code class="codehilite">Main Camera</code>の設定を以下のように変更してください。</p>
<table>
<thead>
<tr>
<th align="center">変更箇所</th>
<th align="center">変更内容</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Position</td>
<td align="center">(0, 10, -10)</td>
</tr>
<tr>
<td align="center">Rotation</td>
<td align="center">(45, 0, 0)</td>
</tr>
</tbody>
</table>
<p>これで、<code class="codehilite">Player</code>が画面の中心に来ました。
ところがゲームを再生させ、<code class="codehilite">Player</code>を移動させてみると、下図のようにPlayerが移動してもついてきません。</p>
<p><img alt="" src="../images/03/MainCameraSettings.png" /></p>
<p>カメラを追従させるさせる方法はいくつかありますがその最も簡単なものはPlayerとMain Cameraを階層構造にすることです。</p>
<h3 id="_7">階層構造<a class="headerlink" href="#_7" title="Permanent link">#</a></h3>
<p>Unityにはゲームオブジェクト同士を親子関係で結び、階層構造をつくる機能があります。
この関係はヒエラルキービューで、子にしたいゲームオブジェクトを親にしたいゲームオブジェクトへとドラッグアンドドロップするだけで形成することができます。
Unityのゲームオブジェクトは親からの相対座標を<code class="codehilite">Transform</code>に保持しているため、子オブジェクトは親オブジェクトを基準として、移動・回転・拡大縮小するのです。
たとえば、親オブジェクトの位置が(1, 1, 1)、子オブジェクトの位置が(0, 1, 2)のとき、子オブジェクトの真の位置(ワールド座標)は(1, 2, 3)となります。</p>
<p>実際にやってみましょう。</p>
<p>下図のように<strong>ヒエラルキービューで<code class="codehilite">Main Camera</code>を<code class="codehilite">Player</code>までドラッグアンドドロップしてください</strong>。</p>
<p><img alt="" src="../images/03/MakeFamily.png" /></p>
<p><code class="codehilite">Main Camera</code>の<code class="codehilite">Transform</code>を見てください。下図のようにMain Cameraのy座標が10から8に変化したことがわかります。</p>
<p><img alt="" src="../images/03/ChildrenCamera.png" /></p>
<p>これは、<code class="codehilite">Player</code>の座標が(0, 2, 0)だったため、ワールド座標で(0, 10, -10)である<code class="codehilite">Main Camera</code>の、<code class="codehilite">Player</code>からの相対座標は、(0, 8, -10)だからです。
こうすると<code class="codehilite">Main Camera</code>は<code class="codehilite">Player</code>からの相対位置を一定に保つように移動するため、ゲームを再生し<code class="codehilite">Player</code>を移動させても、常にこのTransformを維持し続けます。
試にゲームを再生させてみましょう。</p>
<p>下図のように、<code class="codehilite">Main Camera</code>の相対座標は維持されていますが、ゲーム画面が回転して、訳が分からなくなってしまっています。</p>
<p><img alt="" src="../images/03/StartGame.png" /></p>
<p>これは、<code class="codehilite">Player</code>が移動する際に回転をしているためです。
これではゲームとして成り立ちませんね。
この方法は使えないので、下図のように、<strong>Main CameraをPlayerの外にドラッグアンドドロップして、親子関係を解除しましょう</strong>。
ドロップする際、青い横線が出ていることを確認してください。
<img alt="" src="../images/03/DeleteFamily.png" /></p>
<h3 id="_8">スクリプトで追従<a class="headerlink" href="#_8" title="Permanent link">#</a></h3>
<p>親子関係ではうまくいかなかったので、スクリプトから追従させましょう。
前述したように、インスペクター上のコンポーネントは型としてスクリプトで扱えます。
<code class="codehilite">transform</code>型を利用して<code class="codehilite">Main Camera</code>を<code class="codehilite">Player</code>に追従させましょう。</p>
<p>まずは、<strong>「プロジェクトビューでScriptsフォルダーを開く」-&gt;「Create」-&gt;「C# Scripts」</strong>を選択してください。
名前は<strong>「FollowCamera」</strong>とします。
それではFollowCamera.csを開き、以下のように<code class="codehilite">public class FollowCamera : MonoBehaviour { }</code>の中身を編集してください。
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="na">  [SerializeField]</span> <span class="n">Transform</span> <span class="n">target</span><span class="p">;</span>
  <span class="n">Vector3</span> <span class="n">offset</span><span class="p">;</span>

<span class="c1">// Use this for initialization</span>
<span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
      <span class="n">offset</span> <span class="p">=</span> <span class="n">target</span><span class="p">.</span><span class="n">position</span> <span class="p">-</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Update is called once per frame</span>
<span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>
      <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">target</span><span class="p">.</span><span class="n">position</span> <span class="p">-</span> <span class="n">offset</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></p>
<p>順に見ていきます。</p>
<p><strong> <i class="fa fa-circle"></i> 1行目 </strong></p>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="na">  [SerializeField]</span> <span class="n">Transform</span> <span class="n">target</span><span class="p">;</span>
</pre></div>
</td></tr></table>
まず、<code class="codehilite">transform</code>型の変数を宣言しています。
ここには<code class="codehilite">Player</code>の<code class="codehilite">Transform</code>コンポーネントを代入しますが、<code class="codehilite">[SerializeField]</code>にしていることからわかるように、インスペクター上で代入を行おうと思います。
では、代入をしておきましょう。
<span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-s">S</kbd></span>でスクリプトを保存したら、<strong>プロジェクトビューからFollowCamera.csをヒエラルキービュー上のMain Cameraまでドラッグアンドドロップしてください。</strong></p>
<p>つづいて、下図のように、<strong>ヒエラルキービューでMain Cameraを選択した状態で、PlayerをインスペクターにあるFollowCameraのTargetまで、ドラッグアンドドロップしてください。</strong></p>
<p><img alt="" src="../images/03/DragPlayer.png" /></p>
<p>これで完了です。</p>
<p><strong> <i class="fa fa-circle"></i> 2行目 </strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>  <span class="n">Vector3</span> <span class="n">offset</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>ここには初期状態での<code class="codehilite">Player</code>と<code class="codehilite">Main Camera</code>の相対座標を記録します。
こうすることで、<code class="codehilite">Main Camera</code>を<code class="codehilite">Player</code>と一定距離を保ちながら移動させることができます。</p>
<p><strong> <i class="fa fa-circle"></i> 6行目 </strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>      <span class="n">offset</span> <span class="p">=</span> <span class="n">target</span><span class="p">.</span><span class="n">position</span> <span class="p">-</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>単純なベクトル計算によって<code class="codehilite">Player</code>と<code class="codehilite">Main Camera</code>の相対座標を計算しています。
実は、<code class="codehilite">Transform</code>コンポーネントは<code class="codehilite">transform</code>と入力することによって、<code class="codehilite">GetComponent&lt;&gt;()</code>などで取得せずとも使用することができます。
<code class="codehilite">transform.position</code>とすることで、このスクリプトをアタッチしているゲームオブジェクトの<code class="codehilite">Transform</code>コンポーネントの<code class="codehilite">Position</code>の値を<code class="codehilite">Vector3</code>型にして取り出せます。
<code class="codehilite">target.position</code>と書くことで、<code class="codehilite">target</code>に<code class="codehilite">Player</code>の<code class="codehilite">Transform</code>コンポーネントが代入されているため、その<code class="codehilite">Position</code>が取り出されます。</p>
<p><strong> <i class="fa fa-circle"></i> 10-12行目 </strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>
          <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">target</span><span class="p">.</span><span class="n">position</span> <span class="p">-</span> <span class="n">offset</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>毎フレームごとに<code class="codehilite">Main Camera</code>の<code class="codehilite">Position</code>に<code class="codehilite">Player</code>のポジションから相対座標を引いてやることで、<code class="codehilite">Main Camera</code>が移動すべき座標を指定しています。</p>
<h3 id="main-cameraprefab">Main Cameraをprefab化しよう<a class="headerlink" href="#main-cameraprefab" title="Permanent link">#</a></h3>
<p><code class="codehilite">Main Camera</code>も<code class="codehilite">Player</code>や<code class="codehilite">NormalRoad</code>と同じように何度も利用したいのでprefab化しておきましょう。
<strong>ヒエラルキービュー上のMain CameraをプロジェクトビューのPrefasフォルダーへとドラッグアンドドロップ</strong>しましょう。
その後、<span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-s">S</kbd></span>でシーンを保存してください。</p>
<p>それではStage1にも追従する<code class="codehilite">Main Camera</code>を設置しておきましょう。
<strong>プロジェクトビューのScenesフォルダーで、Stage1を選択しましょう</strong>。
Stage1が開けたら、<strong>ヒエラルキービュー上のMain Cameraを選択した状態でDelキーを押してください</strong>。
元の<code class="codehilite">Main Camera</code>を消すことができたら、<strong>プロジェクトビューのPrefasフォルダーから<code class="codehilite">Main Camera</code>をヒエラルキービューへとドラッグアンドドロップしましょう。</strong>
そして、<strong>インスペクターの<code class="codehilite">FollowCamera</code>の<code class="codehilite">Target</code>に<code class="codehilite">Player</code>を代入しておきましょう</strong>。</p>
<h2 id="stage2_1">Stage2の状態を確認しよう<a class="headerlink" href="#stage2_1" title="Permanent link">#</a></h2>
<p>ここまで完成したら、Unityの画面に戻り、<span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-s">S</kbd></span>でゲームを保存しましょう。
それではゲームを再生してみましょう。
<code class="codehilite">Player</code>がどこに移動してもゲーム画面には常に<code class="codehilite">Player</code>が真ん中に映し出されているはずです。</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../03-chapter2/" title="Stage1" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Stage1
              </span>
            </div>
          </a>
        
        
          <a href="../../../etc/" title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Home
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright (c) 2018 Tomoya Ishii
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://kcs1959.jp" class="md-footer-social__link fa fa-globe americas"></a>
    
      <a href="https://twitter.com/kcs1959" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/in/kcs-keio-computer-society-4903a5134/" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.5e60981f.js"></script>
      
        
        
          
          <script src="../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../../assets/javascripts/lunr/lunr.jp.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.2.3.min.js"></script>
      
        <script src="../../../js/script.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script>
      
    
    
      
    
  </body>
</html>